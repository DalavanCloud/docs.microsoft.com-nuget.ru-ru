---
title: Миграция с package.config в форматы PackageReference | Документы Microsoft
author: karann-msft
ms.author: karann
manager: unniravindranathan
ms.date: 03/27/2018
ms.topic: article
ms.prod: nuget
ms.technology: ''
description: Сведения о миграции проекта из формата управления package.config PackageReference с поддержкой NuGet 4.0 + и VS2017 и .NET Core 2.0
keywords: NuGet migrator миграции, пакет ссылки, проект packages.config файлы PackageReference, VS2017, Visual Studio 2017 г., NuGet 4, .NET Core 2.0
ms.reviewer:
- karann
- unnir
ms.workload:
- dotnet
- aspnet
ms.openlocfilehash: 10bd2fe95a6af11806a7edd7a43eaa497486fd80
ms.sourcegitcommit: ecb598c790d4154366bc92757ec7db1a51c34faf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/03/2018
---
# <a name="migrate-from-packagesconfig-to-packagereference"></a>Миграция с packages.config на PackageReference

Visual Studio 2017 г. версия 15,7 предварительной версии 3 и более поздние версии поддерживают при переносе проекта из [packages.config](./packages-config.md) формат управления [PackageReference](../consume-packages/Package-References-in-Project-Files.md) формат.

## <a name="benefits-of-using-packagereference"></a>Преимущества использования PackageReference

* **Управление всех зависимостей проекта в одном месте**: так же, как ссылки проекта на проект и ссылки на сборки, ссылается на пакет NuGet (с помощью `PackageReference` узла) управляются непосредственно в файлах проекта, а не использовать отдельный файл Packages.config.
* **Загромождать представление верхнего уровня зависимостей**: в отличие от packages.config, PackageReference список пакетов NuGet, непосредственно установленные в проекте. В результате пользовательский Интерфейс диспетчера пакетов NuGet и файл проекта не загроможденными при наличии множества зависимостей низкого уровня.
* **Повышение производительности**: при использовании PackageReference, пакеты сохраняются в *глобального пакеты* папку (как описано в статье [управление глобального пакетами и папками кэша](../consume-packages/managing-the-global-packages-and-cache-folders.md) а не в `packages` папки в рамках решения. В результате PackageReference выполняется быстрее и требует меньше места на диске.
* **Точный контроль над зависимости, так и поток содержимого**: с помощью существующих функций MSBuild позволяет [условно ссылаются на пакет NuGet](../consume-packages/Package-References-in-Project-Files.md#adding-a-packagereference-condition) и выберите пакет будет ссылаться на целевой платформы, конфигурации, платформы или других аспектов.
* **PackageReference находится в активной разработке**: в разделе [PackageReference выдает на GitHub](https://aka.ms/nuget-pr-improvements). Packages.config больше не находится в активной разработке.

### <a name="limitations"></a>Ограничения

* NuGet PackageReference не доступны в Visual Studio 2015 и более ранних версий. Перенесенные проекты можно открыть только в Visual Studio 2017 г.
* Миграция не выполняется в настоящее время доступны для проектов C++ и ASP.NET.
* Возможно, некоторые пакеты не полностью совместим с PackageReference. Дополнительные сведения см. в разделе [проблемы совместимости пакетов](#package-compatibility-issues).

## <a name="migration-steps"></a>Действия миграции

> [!Note]
> Перед началом миграции, Visual Studio создает резервную копию проекта, чтобы можно было [выполните откат до packages.config](#how-to-roll-back-to-packagesconfig) при необходимости.

1. Откройте решение, содержащее проект с помощью `packages.config`.

1. В **обозревателе решений**, щелкните правой кнопкой мыши **ссылки** узел или `packages.config` файла и выберите **перенести packages.config PackageReference...** .

1. Migrator анализирует ссылки на пакет NuGet для проекта и предпринимается попытка классифицировать их в **верхнего уровня зависимости** (NuGet пакетов этот каталог вы установили) и **транзитивное зависимости**(пакетов, которые были установлены в качестве зависимости пакетов верхнего уровня).

   > [!Note]
   > PackageReference поддерживает восстановление транзитивное пакета и разрешает зависимости динамически, это означает, что транзитивное зависимости не требуется установка явным образом.

1. (Необязательно) Вы можете обрабатывать пакет NuGet, которые классифицируются как транзитивное зависимостей как зависимость верхнего уровня, выбрав **верхнего уровня** параметр для пакета. Этот параметр автоматически принимает значение пакеты, содержащие ресурсы, которые не проходят транзитивно (в `build`, `buildCrossTargeting`, `contentFiles`, или `analyzers` папок) и тех, помеченные как зависимость разработки (`developmentDependency = "true"`).

1. Просмотреть все [проблемы совместимости пакетов](#package-compatibility-issues).

1. Выберите **ОК** начать миграцию.

1. В конце миграции Visual Studio предоставляет отчет с путем резервного копирования, список установленных пакетов (верхнего уровня зависимости), список пакетов в ссылках как транзитивное зависимости и список проблем совместимости, описанных в начале Миграция. Отчет сохраняется в папку резервного копирования.

1. Проверьте, сборка и запуск решения. Если возникли проблемы, [файлов проблемы на GitHub](https://github.com/NuGet/Home/issues/).

## <a name="how-to-roll-back-to-packagesconfig"></a>Как откатить к packages.config

1. Закройте перенесенного проекта.

1. Скопируйте файл проекта и `packages.config` из резервной копии (обычно `<solution_root>\MigrationBackup\<unique_guid>\<project_name>\`) в папку проекта.

1. Откройте проект.

1. Откройте консоль диспетчера пакетов с помощью **Сервис > Диспетчер пакетов NuGet > консоль диспетчера пакетов** команду меню.

1. В консоли выполните следующую команду:

   ```ps
   update-package -reinstall
   ```

## <a name="package-compatibility-issues"></a>Проблемы совместимости пакета

Некоторые аспекты, которые поддерживались в файле packages.config в PackageReference не поддерживаются. Migrator анализирует и обнаруживает такие проблемы. Любой пакет, имеет один или несколько из следующих проблем могут работать не так, как ожидалось после миграции.

### <a name="installps1-scripts-are-ignored-when-the-package-is-installed-after-the-migration"></a>сценарии «install.ps1» учитываются при установке пакета после миграции

| | |
| --- | --- |
| **Описание** | С PackageReference install.ps1 и uninstall.ps1 скрипты PowerShell не выполняются при установке или удалении пакета. |
| **Потенциальное воздействие** | Пакеты, которые зависят от эти сценарии, чтобы настроить поведение некоторых в проекте назначения может не работать должным образом. |

### <a name="content-assets-are-not-available-when-the-package-is-installed-after-the-migration"></a>активы «content» недоступны при установке пакета после миграции

| | |
| --- | --- |
| **Описание** | Ресурсы в пакете `content` папки с PackageReference не поддерживаются и пропускаются. PackageReference добавляет поддержку `contentFiles` лучшей транзитивное поддержки и общего содержимого.  |
| **Потенциальное воздействие** | Ресурсы в `content` не копируются в проект и проект кода, который зависит от наличия этих средств требуется рефакторинга.  |

### <a name="xdt-transforms-are-not-applied-when-the-package-is-installed-after-the-upgrade"></a>XDT преобразования не применяются при установке пакета после обновления

| | |
| --- | --- |
| **Описание** | XDT преобразования не поддерживаются с PackageReference и `.xdt` файлы пропускаются при установке или удалении пакета.   |
| **Потенциальное воздействие** | XDT преобразования не применяются к XML-файлы в любой проект, наиболее часто `web.config.install.xdt` и `web.config.uninstall.xdt`, означающее проекта` web.config` файл не обновляется при установке или удалении пакета. |

### <a name="assemblies-in-the-lib-root-are-ignored-when-the-package-is-installed-after-the-migration"></a>Сборки в корне lib учитываются при установке пакета после миграции

| | |
| --- | --- |
| **Описание** | Используя PackageReference, представить сборок в корне `lib` папку без целевого определенные вложенные папки платформы учитываются. NuGet ищет вложенной папки, соответствующие target framework моникером соответствующий целевой платформы проекта и устанавливает соответствующие сборки в проект. |
| **Потенциальное воздействие** | Пакеты, которые не имеют вложенную папку сопоставления target framework моникером соответствующий целевой платформы проекта может не работать, как ожидалось после перехода или сбой установки во время миграции |

## <a name="found-an-issue-report-it"></a>Обнаружена проблема? Сообщите об этом!

Если возникли проблемы с взаимодействием миграции [файл проблему в репозитории NuGet GitHub](https://github.com/NuGet/Home/issues/).

---
title: "Пакеты NuGet в шаблонах Visual Studio | Документы Майкрософт"
author: kraigb
ms.author: kraigb
manager: ghogen
ms.date: 2/8/2017
ms.topic: article
ms.prod: nuget
ms.technology: 
ms.assetid: 0b2cf228-f028-475d-8792-c012dffdb26f
description: "Инструкции по включению пакетов NuGet в состав шаблонов проектов и элементов Visual Studio."
keywords: "NuGet в Visual Studio, шаблоны проектов Visual Studio, шаблоны элементов Visual Studio, пакеты в шаблонах проектов, пакеты в шаблонах элементов"
ms.reviewer:
- karann-msft
- unniravindranathan
ms.openlocfilehash: 5b2ad7616578b5f54d917c4555e861c847814da9
ms.sourcegitcommit: d0ba99bfe019b779b75731bafdca8a37e35ef0d9
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/14/2017
---
# <a name="packages-in-visual-studio-templates"></a>Пакеты в шаблонах Visual Studio

Шаблонам проектов и элементов Visual Studio часто требуется обеспечить установку определенных пакетов при создании проекта или элемента. Например, шаблон ASP.NET MVC 3 устанавливает jQuery, Modernizr и другие пакеты.

Для этого авторы шаблонов могут настроить NuGet для установки необходимых пакетов, а не отдельных библиотек. Позднее разработчики могут в любое время легко обновить эти пакеты.

Дополнительные сведения о создании шаблонов см. в разделе [Создание шаблонов проектов и элементов в Visual Studio](https://msdn.microsoft.com/library/s365byhx.aspx) или [Создание пользовательских шаблонов проектов и элементов с помощью пакета SDK для Visual Studio](https://msdn.microsoft.com/library/ff527340.aspx).

Оставшаяся часть этого раздела посвящена конкретным шагам, которые следует предпринять при создании шаблона, чтобы правильно включить пакеты NuGet.

- [Добавление пакетов в шаблон](#adding-packages-to-a-template)
- [Рекомендации](#best-practices)

Например, ознакомьтесь с [примером NuGetInVsTemplates](https://bitbucket.org/marcind/nugetinvstemplates).


## <a name="adding-packages-to-a-template"></a>Добавление пакетов в шаблон

При создании шаблона вызывается [мастер шаблонов](https://msdn.microsoft.com/library/ms185301.aspx) для загрузки списка устанавливаемых пакетов, а также сведений об их расположении. Пакеты могут быть внедрены в VSIX, в шаблон или расположены на локальном жестком диске, в случае чего вы используете раздел реестра, чтобы сослаться на путь к файлу. Сведения об этих расположениях приведены ниже в этом разделе.

Предустановленные пакеты используют для работы [мастеры шаблонов](http://msdn.microsoft.com/library/ms185301.aspx). Специальный мастер вызывается при создании экземпляра шаблона. Он загружает список пакетов, которые нужно установить, и передает эти сведения соответствующим API NuGet.

Шаги по включению пакетов в шаблон:

1. Добавьте в свой файл `vstemplate` ссылку на мастер шаблонов NuGet, добавив элемент [`WizardExtension`](http://msdn.microsoft.com/library/ms171411.aspx):

    ```xml
    <WizardExtension>
        <Assembly>NuGet.VisualStudio.Interop, Version=1.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a</Assembly>
        <FullClassName>NuGet.VisualStudio.TemplateWizard</FullClassName>
    </WizardExtension>
    ```

    `NuGet.VisualStudio.Interop.dll` — это сборка, содержащая только класс`TemplateWizard`, который представляет собой простую программу-оболочку, вызывающую фактическую реализацию в `NuGet.VisualStudio.dll`. Версия сборки не изменится, поэтому эти шаблоны проектов и элементов продолжат работать с новыми версиями NuGet.

1. Добавьте список устанавливаемых пакетов в проект:

    ```xml
    <WizardData>
        <packages>
            <package id="jQuery" version="1.6.2" />
        </packages>
    </WizardData>
    ```

    *(NuGet 2.2.1+)*  Мастер поддерживает несколько элементов `<package>` для поддержки нескольких источников пакетов. Требуются оба атрибута `id` и `version`, то есть эта конкретная версия пакета будет установлена, даже если доступна более новая версия. Это не позволяет обновлениям пакета нарушить работу шаблона и предоставляет возможность обновить пакет разработчику, использующему шаблон.


1. Укажите репозиторий, где NuGet может найти пакеты, как описано в следующих разделах.

### <a name="vsix-package-repository"></a>Репозиторий пакетов VSIX

Для развертывания шаблонов проектов и элементов Visual Studio рекомендуется использовать [расширение VSIX](http://msdn.microsoft.com/library/ff363239.aspx), так как оно дает возможность упаковать вместе несколько шаблонов проектов или элементов и позволяет разработчикам легко находить ваши шаблоны с помощью диспетчера расширений VS или коллекции Visual Studio. Обновления для этого расширения также легко развернуть с помощью [механизма автоматического обновления в диспетчере расширений Visual Studio](http://msdn.microsoft.com/library/dd997169.aspx).

Сам VSIX может служить источником необходимых шаблону пакетов:

1. Измените элемент `<packages>` в файле `.vstemplate` следующим образом:

    ```xml
    <packages repository="extension" repositoryId="MyTemplateContainerExtensionId">
        <!-- ... -->
    </packages>
    ```

    Атрибут `repository` задает тип репозитория как `extension`, а `repositoryId` является уникальным идентификатором самого VSIX (это значение [атрибута `ID`](http://msdn.microsoft.com/library/dd393688.aspx) в файле `vsixmanifest` расширения).

1. Поместите файлы `nupkg` в папку `Packages` внутри VSIX.
1. Добавьте необходимые файлы пакетов в качестве [содержимого пользовательского расширения](http://msdn.microsoft.com/library/dd393737.aspx) в свой файл `source.extension.vsixmanifest`. Если вы используете схему 2.0, он должен выглядеть следующим образом:

    ```xml
    <Asset Type="Moq.4.0.10827.nupkg" d:Source="File" Path="Packages\Moq.4.0.10827.nupkg" d:VsixSubPath="Packages" />
    ```

    Если вы используете схему 1.0, он должен выглядеть следующим образом:

    ```xml
    <CustomExtension Type="Moq.4.0.10827.nupkg">
        packages/Moq.4.0.10827.nupkg
    </CustomExtension>
    ```

1. Обратите внимание, что можно доставить пакеты в тот же VSIX, что и шаблоны проекта, либо поместить их в отдельный VSIX, если это лучше подходит для вашего сценария. Однако не следует ссылаться на любой VSIX, которым вы не управляете, так как изменения в этом расширении могут нарушить работу шаблона.


### <a name="template-package-repository"></a>Репозиторий пакетов шаблонов

Если вы распространяете только один шаблон проектов или элементов и вам не нужно паковать вместе несколько шаблонов, можно использовать более простой, хотя и ограниченный, подход, включающий пакеты непосредственно в ZIP-файл шаблона проектов или элементов:

1. Измените элемент `<packages>` в файле `.vstemplate` следующим образом:

    ```xml
    <packages repository="template"">
        <!-- ... -->
    </packages>
    ```

    Атрибут `repository` имеет значение `template`, а атрибут `repositoryId` не является обязательным.

1. Поместите пакеты в корневую папку в ZIP-файле шаблона проектов или элементов.

Обратите внимание, что применение такого подхода для VSIX, содержащего несколько шаблонов, приводит к ненужному раздуванию, когда один или несколько пакетов являются общими для шаблонов. В таких случаях используйте [VSIX в качестве репозитория](#vsix-package-repository), как описано в предыдущем разделе.


### <a name="registry-specified-folder-path"></a>Путь к папке, указанный для реестра

Пакеты SDK, устанавливаемые с помощью MSI, могут устанавливать пакеты NuGet непосредственно на компьютере разработчика. В результате их не требуется извлекать при использовании шаблона проектов или элементов, они доступны сразу же. Этот подход используется в шаблонах ASP.NET.

1. Позвольте MSI установить пакеты на компьютере. Вы можете установить файлы `.nupkg` отдельно либо вместе с расширенным содержимым, которое позволяет пропустить один из шагов при использовании шаблона. В этом случае следуйте стандартной структуре папок NuGet, когда файлы `.nupkg` находятся в корневой папке, а каждый пакет имеет вложенную папку, имя которой состоит из пары идентификатора и версии.

1. Запишите раздел реестра для определения расположения пакета:

    - Расположение ключа: либо на уровне компьютера `HKEY_LOCAL_MACHINE\SOFTWARE[\Wow6432Node]\NuGet\Repository`, либо, если шаблоны и пакеты установлены для конкретного пользователя, можно также использовать `HKEY_CURRENT_USER\SOFTWARE\NuGet\Repository`.
    - Имя ключа: используйте уникальное имя. Например, шаблоны ASP.NET MVC 4 для Visual Studio 2012 используют `AspNetMvc4VS11`.
    - Значения: полный путь к папке пакетов.

1. Добавьте в элемент `<packages>` в файле `.vstemplate` атрибут `repository="registry"` и укажите имя раздела реестра в атрибуте `keyName`.

    - Если вы заранее распаковали пакеты, используйте атрибут `isPreunzipped="true"`.
    - *(NuGet 3.2+)* Если вы хотите принудительно выполнить сборку времени разработки в конце установки пакета, добавьте атрибут `forceDesignTimeBuild="true"`.
    - Для оптимизации добавьте `skipAssemblyReferences="true"`, так как шаблон уже включает в себя необходимые ссылки.

        ```xml
        <packages repository="registry" keyName="AspNetMvc4VS11" isPreunzipped="true">
            <package id="EntityFramework" version="5.0.0" skipAssemblyReferences="true" />
            <-- ... -->
        </packages>
        ```

## <a name="best-practices"></a>Рекомендации

1. Объявите о зависимости от NuGet VSIX, добавив ссылку на него в манифесте VSIX:

    ```xml
    <Reference Id="NuPackToolsVsix.Microsoft.67e54e40-0ae3-42c5-a949-fddf5739e7a5" MinVersion="1.7.30402.9028">
        <Name>NuGet Package Manager</Name>
        <MoreInfoUrl>http://docs.microsoft.com/nuget/</MoreInfoUrl>
    </Reference>
    <!-- ... -->
    ```

1. Настройте сохранение шаблонов элементов и проектов при создании, задав [`<PromptForSaveOnCreation>`](http://msdn.microsoft.com/library/twfxayz5.aspx) в файле `.vstemplate`.

1. Шаблоны не содержат файл `packages.config` или `project.json`, а также ссылки или содержимое, которое следует добавить при установке пакетов NuGet.

---
title: NuGet кросс-подключаемые модули платформы
description: NuGet cross платформы подключаемые модули для NuGet.exe, dotnet.exe, msbuild.exe и Visual Studio
author: nkolev92
ms.author: nikolev
ms.date: 07/01/2018
ms.topic: conceptual
ms.openlocfilehash: fdefc5b6189051fd83b2de644080284c09dd85f4
ms.sourcegitcommit: 1d1406764c6af5fb7801d462e0c4afc9092fa569
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/04/2018
ms.locfileid: "43548210"
---
# <a name="nuget-cross-platform-plugins"></a>NuGet кросс-подключаемые модули платформы

В NuGet 4.8 + добавлена поддержка между подключаемыми модулями платформы.
Это было достигнуто с путем построения новой модели расширяемости подключаемый модуль, который должен соответствовать строгому набору правил операции.
Подключаемые модули являются самодостаточные исполняемые файлы (runnables в мире .NET Core), который клиенты NuGet запуска в отдельном процессе.
Это true записи один раз, везде запуска подключаемого модуля. Он будет работать со все клиентские средства NuGet.
Подключаемые модули могут быть .NET Framework (NuGet.exe, MSBuild.exe и Visual Studio) или .NET Core (dotnet.exe).
Протокол с версиями связи между клиентом NuGet и подключаемый модуль определен. Во время подтверждения запуска 2 процессы согласование версии протокола.

Чтобы охватить все сценарии средства клиента NuGet, один потребуется .NET Framework и .NET Core подключаемого модуля.
Ниже описаны сочетания клиента/framework подключаемые модули.

| Клиентская программа  | Платформа |
| ------------ | --------- |
| Visual Studio | .NET Framework |
| DotNet.exe | .NET Core |
| NuGet.exe | .NET Framework |
| MSBuild.exe | .NET Framework |
| NuGet.exe в Mono | .NET Framework |

## <a name="how-does-it-work"></a>Как это работает

Верхнего уровня рабочего процесса можно описать следующим образом:

1. NuGet обнаруживает доступных подключаемых модулей.
1. Если это применимо, NuGet переберет все подключаемые модули в порядке приоритета и начинает их один за другим.
1. NuGet будет использовать первый подключаемый модуль, который может обработать запрос.
1. Подключаемые модули будет завершена, когда они больше не требуются.

## <a name="general-plugin-requirements"></a>Подключаемый модуль общие требования

Текущая версия протокола — *2.0.0*.
В данной версии действуют следующие требования:

- Имеют допустимый, доверенных Authenticode подпись сборки, которые будут выполняться в Windows и Mono. Для сборок, под управлением Linux и Mac еще не требуется специальных доверия. [Важным проблемам](https://github.com/NuGet/Home/issues/6702)
- Поддержка запуска в текущем контексте безопасности клиентских средств NuGet без отслеживания состояния. Например клиентские средства NuGet не выполняет повышение уровня или дополнительную инициализацию за пределами протокола подключаемый модуль, описанным ниже.
- Быть неинтерактивной, если не указано явным образом.
- Соответствовать версии протокола в согласованном подключаемого модуля.
- Отвечать на все запросы в течение разумного периода.
- Удовлетворять запросы отмены для любой выполняемой операции.

Техническая спецификация описан более подробно в следующих спецификациях:

- [Подключаемый модуль для загрузки пакета NuGet](https://github.com/NuGet/Home/wiki/NuGet-Package-Download-Plugin)
- [NuGet кросс-Платформенная надстройка проверки подлинности](https://github.com/NuGet/Home/wiki/NuGet-cross-plat-authentication-plugin)

## <a name="client---plugin-interaction"></a>Клиент — подключаемый модуль взаимодействия

Клиентские средства NuGet и подключаемые модули взаимодействуют с JSON, через стандартные потоки (stdin, stdout, stderr). Все данные должны быть в кодировке UTF-8.
Подключаемые модули запускаются с аргументом «-подключаемый модуль». В случае, если пользователь напрямую запускает исполняемый файл без этот аргумент подключаемого модуля, подключаемый модуль можно предоставить информационное сообщение, а не ждать подтверждения протокола.
Время ожидания подтверждения протокола — 5 секунд. Подключаемый модуль следует выполнить настройки в качестве хватает сумму максимально.
Клиентские средства NuGet будет запрашивать поддерживаемые операции подключаемый модуль, передавая индекс службы для источника NuGet. Подключаемый модуль может использовать индекс службы для проверки на наличие поддерживаемых типов служб.

Обмен данными между клиентских средств NuGet и подключаемый модуль является двунаправленным. Каждый запрос имеет время ожидания 5 секунд. Если операции должны займет больше времени, процесс соответствующей должны отправлять сообщения о ходе выполнения для предотвращения превышения времени ожидания запроса. Через 1 минуту бездействия подключаемый модуль считается бездействующим и завершает работу.

## <a name="plugin-installation-and-discovery"></a>Установка подключаемого модуля и обнаружения

Подключаемые модули будут обнаружены через структуру каталогов на основе соглашения.
Непрерывной интеграции и сценариев и Опытные пользователи могут использовать переменную среды для переопределения поведения.

- `NUGET_PLUGIN_PATHS` -Определяет подключаемых модулей, который будет использоваться для этого процесса NuGet, приоритет зарезервировано. Если эта переменная среды, оно переопределяет соглашение на основе обнаружения.
-  Расположение пользователя, расположения домашней NuGet в `%UserProfile%/.nuget/plugins`. Это расположение не может быть переопределены. Другой корневой каталог будет использоваться для подключаемых модулей .NET Core и .NET Framework.

| Платформа | Корневое расположение обнаружения  |
| ------- | ------------------------ |
| .NET Core |  `%UserProfile%/.nuget/plugins/netcore` |
| .NET Framework | `%UserProfile%/.nuget/plugins/netfx` |

Каждый подключаемый модуль должен быть установлен в его собственной папке.
Точка входа подключаемый модуль будет имя установленного папки, с расширением DLL для .NET Core и расширением .exe для платформы .NET Framework.

```
.nuget
    plugins
        netfx
            myPlugin
                myPlugin.exe
                nuget.protocol.dll
                ...
        netcore
            myPlugin
                myPlugin.dll
                nuget.protocol.dll
                ...
```

> [!Note]
> В данный момент нет описания функциональности пользователя для установки подключаемых модулей. Это всего лишь переместить необходимые файлы в заранее определенное место.

## <a name="supported-operations"></a>Поддерживаемые операции

Две операции поддерживаются в разделе нового протокола подключаемого модуля.

| Имя операции | Минимальное семейству. | Минимальная версия клиента NuGet |
| -------------- | ----------------------- | --------------------- |
| Загрузить пакет | 1.0.0 | 4.3.0 |
| [Проверка подлинности](NuGet-Cross-Platform-Authentication-Plugin.md) | 2.0.0 | 4.8.0 |

## <a name="running-plugins-under-the-correct-runtime"></a>Запуск подключаемых модулей под нужная среда выполнения

Для NuGet в сценариях dotnet.exe подключаемые модули должны иметь возможность выполнения в группе, определенную среду выполнения из dotnet.exe.
Именно поставщик подключаемого модуля и производитель, чтобы убедиться в том, что используется сочетание совместимых dotnet.exe/plugin.
Потенциальная проблема может возникнуть с подключаемыми модулями расположения пользователя, когда, например, dotnet.exe в разделе среды выполнения 2.0 пытается использовать подключаемый модуль для 2.1 среды выполнения.

## <a name="capabilities-caching"></a>Возможности кэширования

Проверка безопасности и создание подключаемых модулей является дорогостоящим. Операции загрузки происходит так чаще, чем операции проверки подлинности, однако только средний пользователь NuGet может работать подключаемый модуль проверки подлинности.
Чтобы упростить работу, NuGet будет кэшировать утверждения операции для указанного запроса. Этот кэш является одного подключаемого модуля с ключом подключаемого модуля, что путь подключаемого модуля и истечения срока действия для этого возможности кэша составляет 30 дней. 

Кэш находится в `%LocalAppData%/NuGet/plugins-cache` и будет заменена с переменной среды `NUGET_PLUGINS_CACHE_PATH`. Снимите этот [кэша](../../consume-packages/managing-the-global-packages-and-cache-folders.md), "Локальные" можно запускать с `plugins-cache` параметр.
`all` Параметр "Локальные" теперь также удалит кэша подключаемых модулей. 

## <a name="protocol-messages-index"></a>Индекс сообщений протокола

Версия протокола *1.0.0* сообщений:

1.  Закрыть
    * Запросить направление: NuGet -> подключаемого модуля
    * Запрос будет содержать полезные данные не найдены
    * Ответ не ожидается.  Адекватный ответ касается незамедлительно завершения процесса подключаемого модуля.

2.  Скопируйте файлы в пакете
    * Запросить направление: NuGet -> подключаемого модуля
    * Запрос будет содержать:
        * ИД пакета и версии
        * расположение репозитория источника пакета
        * путь к целевому каталогу
        * Перечисление файлов в пакете для копирования конечный каталог
    * Ответ будет содержать:
        * код ответа, указывающее результат операции
        * Перечисление полные пути для копирования файлов в каталоге назначения, если операция выполнена успешно

3.  Скопируйте файл пакета (файла nupkg)
    * Запросить направление: NuGet -> подключаемого модуля
    * Запрос будет содержать:
        * ИД пакета и версии
        * расположение репозитория источника пакета
        * путь к конечному файлу
    * Ответ будет содержать:
        * код ответа, указывающее результат операции

4.  Получение учетных данных
    * Запросить направление: подключаемый модуль "->" NuGet
    * Запрос будет содержать:
        * расположение репозитория источника пакета
        * Код состояния HTTP, полученный из репозитория источника пакетов с помощью текущих учетных данных
    * Ответ будет содержать:
        * код ответа, указывающее результат операции
        * имя пользователя, если он доступен
        * пароль, если он доступен

5.  Получить файлы в пакете
    * Запросить направление: NuGet -> подключаемого модуля
    * Запрос будет содержать:
        * ИД пакета и версии
        * расположение репозитория источника пакета
    * Ответ будет содержать:
        * код ответа, указывающее результат операции
        * Перечислимый объект путей к файлам в пакете, если операция выполнена успешно

6.  Получить операции утверждения 
    * Запросить направление: NuGet -> подключаемого модуля
    * Запрос будет содержать:
        * index.json службы для источника пакета
        * расположение репозитория источника пакета
    * Ответ будет содержать:
        * код ответа, указывающее результат операции
        * Перечисление поддерживаемые операции (например: загрузка пакета), если операция выполнена успешно.  Если подключаемый модуль не поддерживает источник, подключаемый модуль должен возвращать пустой набор поддерживаемых операций.

> [!Note]
> Это сообщение была обновлена в версии *2.0.0*. Это на стороне клиента для сохранения обратной совместимости.

7.  Получить хэш пакета.
    * Запросить направление: NuGet -> подключаемого модуля
    * Запрос будет содержать:
        * ИД пакета и версии
        * расположение репозитория источника пакета
        * хэш-алгоритм
    * Ответ будет содержать:
        * код ответа, указывающее результат операции
        * Хэш файла пакета, используя запрошенный хэш-алгоритм, если операция выполнена успешно

8.  Получение версий пакета
    * Запросить направление: NuGet -> подключаемого модуля
    * Запрос будет содержать:
        * Идентификатор пакета
        * расположение репозитория источника пакета
    * Ответ будет содержать:
        * код ответа, указывающее результат операции
        * Перечисление версий пакета, если операция выполнена успешно

9.  Получите индекс службы
    * Запросить направление: подключаемый модуль "->" NuGet
    * Запрос будет содержать:
        * расположение репозитория источника пакета
    * Ответ будет содержать:
        * код ответа, указывающее результат операции
        * Индекс службы, если операция выполнена успешно

10.  Подтверждение
     * Запросить направление: подключаемого модуля NuGet <> –
     * Запрос будет содержать:
         * Текущая версия протокола подключаемого модуля
         * Минимальная поддерживаемая версия протокола подключаемого модуля
     * Ответ будет содержать:
         * код ответа, указывающее результат операции
         * версия согласованный протокол, если операция выполнена успешно.  Сбой приведет к завершению работы подключаемого модуля.

11.  Инициализация
     * Запросить направление: NuGet -> подключаемого модуля
     * Запрос будет содержать:
         * версия средства клиента NuGet
         * NuGet средство эффективный язык клиента.  Это учитывает параметр ForceEnglishOutput, если используется.
         * по умолчанию время ожидания запроса, который заменяет значение по умолчанию протокол.
     * Ответ будет содержать:
         * код ответа, указывающее результат операции.  Сбой приведет к завершению работы подключаемого модуля.

12.  Журнал
     * Запросить направление: подключаемый модуль "->" NuGet
     * Запрос будет содержать:
         * уровень ведения журнала для запроса
         * в журнал сообщения
     * Ответ будет содержать:
         * код ответа, указывающее результат операции.

13.  Отслеживать завершения работы процесса NuGet
     * Запросить направление: NuGet -> подключаемого модуля
     * Запрос будет содержать:
         * Идентификатор процесса NuGet
     * Ответ будет содержать:
         * код ответа, указывающее результат операции.

14.  Предварительная загрузка пакета
     * Запросить направление: NuGet -> подключаемого модуля
     * Запрос будет содержать:
         * ИД пакета и версии
         * расположение репозитория источника пакета
     * Ответ будет содержать:
         * код ответа, указывающее результат операции

15.  Задание учетных данных
     * Запросить направление: NuGet -> подключаемого модуля
     * Запрос будет содержать:
         * расположение репозитория источника пакета
         * последний username источника пакетов, если он доступен
         * Последний пароль источника пакетов, если он доступен
         * последние известные прокси-сервер имя пользователя, если он доступен
         * Последний пароль известных прокси-сервера, если он доступен
     * Ответ будет содержать:
         * код ответа, указывающее результат операции

16.  Уровень ведения журнала набора
     * Запросить направление: NuGet -> подключаемого модуля
     * Запрос будет содержать:
         * уровень ведения журнала по умолчанию
     * Ответ будет содержать:
         * код ответа, указывающее результат операции

Версия протокола *2.0.0* сообщений

17. Получить операции утверждения

* Запросить направление: NuGet -> подключаемого модуля
    * Запрос будет содержать:
        * index.json службы для источника пакета
        * расположение репозитория источника пакета
    * Ответ будет содержать:
        * код ответа, указывающее результат операции
        * Перечислимый объект по поддерживаемым операциям, если операция выполнена успешно.  Если подключаемый модуль не поддерживает источник, подключаемый модуль должен возвращать пустой набор поддерживаемых операций.

    Если источник индекса и пакета службы имеют значение null, подключаемый модуль можно ответить с помощью проверки подлинности.

18. Получить учетные данные проверки подлинности

* Запросить направление: NuGet -> подключаемого модуля
* Запрос будет содержать:
    * URI
    * isRetry
    * Неинтерактивная
    * CanShowDialog
* Ответ будет содержать
    * Имя пользователя
    * Пароль
    * Сообщение
    * Список типов проверки подлинности
    * MessageResponseCode